 ## 9장. **메모리 매핑**

  * [9-1 메모리 매핑과 해제](#9-1-메모리-매핑과-해제)
  * [9-2 파일 확장과 메모리 매핑](#9-2-파일-확장과-메모리-매핑)
  * [9-3 매핑된 메모리 동기화와 데이터 교환](#9-3-매핑된-메모리-동기화와-데이터-교환)

리눅스 시스템이 제공하는 통신 기능은 크게 두 가지로 구분할 수 있다.  
첫 번째는 동일한 시스템 안에 있는 프로세스 사이에서 통신을 수행하는 것이고, 두번째는 서로 다른 시스템에서 수행하고 있는 프로세스 사이에서 통신으로 데이터를 주고받는 것이다.

* 프로세스 간 통신  
프로세스 간 통신(IPC : InterProcess Communication) 은 동일한 시스템 안에서 수행 중인 프로세스끼리 데이터를 주고받는 것이다.  
IPC에는 파이프같은 특수 파일을 이용하거나, 메모리 매핑이나 공유 메모리 같은 메모리 영역을 이용하는 방법이 있다.  
또한 메세지 큐, 공유 메모리, 세마포어 등 유닉스 시스템 V 에서 제공하는 IPC 방법이 있다.

### 9-1 메모리 매핑과 해제  

1. 메모리 매핑 함수  
mmap() 함수를 사용하면 파일을 프로세스의 가상 메모리에 매핑할 수 있다.  
메모리에 매핑된 데이터는 파일 입출력 함수를 사용하지 않고 직접 읽고 쓸 수 있다는 장점이 있다.
``` c
#include <sys/mman.h>

void *mmap(void *addr, size_t length, int prot, int flags, int fd, off_t offset);
```
addr : 메핑할 메모리 주소  
length : 메모리 공간의 크기  
prot : 보호 모드  
flags : 매핑된 데이터의 처리 방법 지정 상수  
fd : 파일 기술자  
offset : 파일 오프셋  

* prot 인자 값  
prot에 사용할수 있는 값은 상수로 정의 되어있으며, OR 연산자로 연결해 지정할 수 있다.

|값|설명|
|:--:|--|
|PROT_READ|매핑된 파일을 읽기를 허용한다.|
|PROT_WRITE|매핑된 파일에 쓰기를 허용한다.|
|PROT_EXEC|매핑된 파일을 실행할 수 있다.|
|PROT_NONE|매핑된 파일에 접근할 수 있다.|

* flags 인자 값  

|값|설명|
|:--:|--|
|MAP_SHARED|다른 프로세스와 공유 가능, 프로세스 외부 생성|
|MAP_SHARED_VALIDATE|다른 프로세스와 공유 가능, 프로세스 외부 생성</br>(전달 받은 플래그를 커널이 모두 확인하고 모르는 플래그가 있을 경우 오류로 처리)|
|MAP_PRIVATE|프로세스 내에서만 사용, 프로세스 내부 생성|
|MAP_ANONYMOUS|fd를 무시하고 할당된 메모리 영역을 0으로 초기화한다. offset은 0이어야 함|
|MAP_ANON|MAP_ANONYMOUS 같은 플래그로 다른 시스템과의 호환성을 위해 제공|
|MAP_FIXED|지정된 주소로 공간 지정, 지정된 공간에 생성|
|MAP_NORESERVE|MAP_PRIVATE를 지정하면 시스템은 매핑에 할당된 메모리 공간만큼 스왑 영역을 할당한다.|


### 9-2 파일 확장과 메모리 매핑  

### 9-3 매핑된 메모리 동기화와 데이터 교환  
