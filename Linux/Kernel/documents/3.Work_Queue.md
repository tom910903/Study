# 3장. Work Queue

  * [3-1 Work Queue 란?](#3-1-work-queue-란)
  * [3-2 Work Queue 종류](#3-2-work-queue-종류)

## 3-1 Work Queue 란?
  리눅스 커널에서 워크 큐(Work Queue)는 백그라운드에서 비동기적으로 수행해야 하는 작업을 예약하는 메커니즘이다.  
  워크 큐는 일반적으로 시간이 오래 걸리거나 커널을 차단할 수 있는 작업을 즉시 수행할 수 없을 때 사용된다.

  리눅스 커널에서 워크 큐는 인터럽트 핸들러, 디바이스 드라이버 및 다른 커널 하위 시스템 등 다양한 컨텍스트에서 사용된다.

  워크 큐의 기본 아이디어는 커널 코드가 나중에 별도의 커널 스레드에서 수행될 작업을 예약할 수 있도록 하는 것이다.  
  이 스레드는 워커 스레드(Worker Thread) 또는 워커 프로세스(Worker Process)라고도 한다.  
  수행할 작업은 워크 구조체(Work Structure)에 캡슐화되어 워크 큐에 추가된다.

  워커 스레드가 작업을 수행할 준비가 되면, 작업 구조체를 큐에서 제거하고 해당 구조체와 연결된 작업 함수를 실행한다.  
  작업이 완료되면 작업 구조체가 해제되고, 워커 스레드는 대기 상태로 돌아가 추가로 예약된 작업을 기다린다.

  워크 큐는 시스템 워크 큐와 CPU별 워크 큐 두 가지 종류가 있다.  
  시스템 워크 큐는 시스템 내 모든 CPU에서 공유되며, 장치 드라이버 등 전역적으로 수행되어야 하는 작업에 사용된다.  
  CPU별 워크 큐는 시스템 내 각 CPU에 구체적으로 할당되며, 프로세스 계정 정보 업데이트 등 로컬하게 수행 가능한 작업에 사용된다.

## 3-2 Work Queue 종류
  Linux 커널에서는 여러 가지 유형의 work queue가 있으며, 각각 특정한 특성과 사용 사례를 갖고 있다.  
  다음은 가장 일반적으로 사용되는 유형이다.

  1. System Work Queues  
    시스템 워크 큐는 어떤 특정 디바이스나 서브시스템과 직접적으로 관련이 없는 시스템 관련 작업을 수행하는 데 사용된다.  
    시스템 워크 큐 작업의 예로는 메모리 관리, 프로세스 스케줄링, 기타 일반적인 커널 작업 등이 있다.

  2. Device Work Queues  
    디바이스 워크 큐는 특정 디바이스나 서브시스템과 관련된 작업을 처리하기 위해 사용된다.  
    예를 들어, 디바이스 드라이버는 네트워크 인터페이스에서 들어오는 데이터 처리와 관련된 작업을 수행하기 위해 디바이스 워크 큐를 사용할 수 있다.

  3. CPU Work Queues  
    CPU Work Queues는 특정 CPU에만 해당되는 작업을 수행하는 데 사용됩니다.  
    이것은 특정 하드웨어 구성 요소에서 저수준 작업을 수행할 때와 같이 특정 CPU에서 작업을 더 효율적으로 수행할 수 있는 경우에 유용하다.

  4. High Priority Work Queues  
    High Priority Work Queues는 일반적인 시스템 작업보다 높은 우선순위를 갖는 작업을 수행하는 데 사용된다.  
    이러한 작업은 실시간 오디오 또는 비디오 처리와 같은 시간에 민감한 작업에 대해 일반적으로 사용된다.

  5. Low Priority Work Queues  
    Low Priority Work Queues는 일반적인 시스템 작업보다 낮은 우선순위를 갖는 작업을 수행하는 데 사용된다.  
    이러한 작업은 시스템 성능에 영향을 미치지 않고 백그라운드에서 수행될 수 있는 작업에 대해 일반적으로 사용된다.

  각각의 작업 대기열 유형마다 특징과 사용 사례가 있다.  
  개발자는 특정 작업에 적합한 작업 대기열 유형을 선택함으로써, 시스템 성능이나 안정성에 부정적인 영향을 미치지 않고 코드가 시간적으로 효율적으로 실행되도록 보장할 수 있다.

