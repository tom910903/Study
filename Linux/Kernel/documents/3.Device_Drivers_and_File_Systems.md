# 3장. **디바이스 드라이버 및 파일 시스템**

  * [문자 장치 및 블록 장치 드라이버](#3-1-문자-장치-및-블록-장치-드라이버)
  * [파일 시스템 유형 및 특성](#3-2-파일-시스템-유형-및-특성)
  * [액세스 제어 목록 및 파일 시스템 권한](#3-3-액세스-제어-목록-및-파일-시스템-권한)

## 3-1 문자 장치 및 블록 장치 드라이버  
  Linux 커널에서 장치 드라이버는 하드웨어 장치를 제어하고 통신하는 역할을 담당한다.  
  장치 드라이버에는 문자 장치 드라이버와 블록 장치 드라이버라는 두 가지 주요 유형이 있다.  
  장치 드라이버에 대해 알아보자.  

  1. 문자 장치 드라이버  
      문자 장치 드라이버는 한 번에 한 문자씩 데이터를 송수신할 수 있는 장치 드라이버 유형이다.  
      이 유형의 드라이버는 직렬 포트, 키보드 및 마우스와 같이 문자 스트림으로 액세스할 수 있는 장치에 사용된다.  
      
      문자 장치 드라이버는 장치 파일을 통해 사용자 공간 애플리케이션과 통신한다.  
      사용자 공간 애플리케이션이 문자 장치에서 읽거나 쓰기를 원할 때 해당 장치 파일을 열고 파일 설명자에 대한 읽기 또는 쓰기 작업을 수행한다.  
      그런 다음 드라이버는 이러한 작업을 하드웨어 장치에 대한 요청으로 변환한다.  
      
      문자 장치 드라이버는 다양한 커널 API와 데이터 구조를 사용하여 해당 기능을 구현한다.  
      여기에는 장치 파일에서 수행할 수 있는 연산을 정의하는 `file_operations` 구조체와 드라이버가 인터럽트와 같은 비동기 이벤트를 사용자 공간 애플리케이션에 알릴 수 있도록 하는 `fasync` 메커니즘이 포함된다.

  2. 블록 장치 드라이버  
      블록 장치 드라이버는 데이터 블록으로 데이터를 송수신할 수 있는 장치 드라이버의 한 유형이다.  
      이 유형의 드라이버는 하드 디스크, USB 드라이브 및 SD 카드와 같이 랜덤 액세스 블록 장치로 액세스할 수 있는 장치에 사용된다.  

      블록 장치 드라이버는 블록 장치 파일을 통해 사용자 공간 애플리케이션과 통신한다.  
      사용자 공간 애플리케이션이 블록 장치에서 읽거나 블록 장치에 쓰려고 하면 해당 블록 장치 파일을 열고 파일 설명자에 대한 읽기 또는 쓰기 작업을 수행한다.  
      그런 다음 드라이버는 이러한 작업을 하드웨어 장치에 대한 요청으로 변환한다.

      블록 장치 드라이버는 다양한 커널 API와 데이터 구조를 사용하여 해당 기능을 구현한다.  
      여기에는 블록 장치에서 수행할 수 있는 연산을 정의하는 `block_device_operations` 구조체와 장치에서 데이터 요청을 관리하는 `request_queue` 메커니즘이 포함된다.

  3. 문자 장치 드라이버와 블록 장치 드라이버의 차이점  
      문자 장치 드라이버와 블록 장치 드라이버의 주요 차이점은 데이터 전송 및 통신 방식에 있다.  
      문자 장치 드라이버는 한 번에 한 문자씩 데이터를 전송하며 문자 스트림으로 액세스할 수 있는 장치에 사용된다.  
      블록 장치 드라이버는 데이터를 블록 단위로 전송하며 랜덤 액세스 블록 장치로 액세스할 수 있는 장치에 사용된다.
      
      또 다른 주요 차이점은 데이터 버퍼링을 처리하는 방식에 있다.  
      문자 장치 드라이버는 일반적으로 한 번에 한 문자씩 데이터를 처리하기 때문에 버퍼가 더 작다.  
      반면에 블록 장치 드라이버는 블록 단위로 데이터를 처리하므로 일반적으로 더 큰 버퍼를 사용한다.

## 3-2 파일 시스템 유형 및 특성
  파일 시스템은 Linux를 포함한 모든 운영 체제의 필수적인 부분이다.  
  파일 시스템은 저장 장치의 파일, 디렉터리 및 기타 데이터를 관리한다.  
  Linux에는 각각 고유한 특성과 기능을 가진 여러 유형의 파일 시스템을 사용할 수 있다.  
  ext2/3/4, Btrfs, XFS 및 ZFS를 포함하여 Linux에서 가장 일반적으로 사용되는 파일 시스템에 대해 알아보자.

  1. ext2/3/4  
      ext 파일 시스템 제품군은 Linux에서 가장 오래되고 가장 널리 사용되는 파일 시스템이다.  
      ext2는 수년 동안 기본 파일 시스템이었지만 지금은 ext3와 ext4로 대체되었다.  
      ext3에 비해 ext4의 주요 장점은 향상된 성능과 확장성, 그리고 더 큰 파일 시스템과 파일을 지원한다는 것이다.

      ext 파일 시스템의 중요한 한계 중 하나는 내장된 데이터 보호 및 복구 메커니즘이 없다는 것이다.  
      예기치 않은 정전이나 시스템 충돌이 발생하면 데이터가 손상되거나 손실될 수 있다.  
      또 다른 단점은 최적의 성능을 유지하기 위해 파일 시스템을 주기적으로 조각 모음해야 한다는 것이다.

  2. Btrfs  
      Btrfs는 ext 파일 시스템 계열의 한계를 해결하기 위해 설계된 비교적 새로운 파일 시스템이다.  
      이 파일 시스템은 Copy-On-Write 파일 시스템으로, 데이터를 수정할 때마다 기존 데이터를 덮어쓰지 않고 새 위치에 기록힌다.  
      이 방식은 정전이나 시스템 충돌 시에도 데이터가 손상되지 않도록 보장힌다.

      Btrfs는 스냅샷, 하위 볼륨, 온라인 크기 조정과 같은 고급 기능을 지원하므로 데스크톱과 서버 시스템에 좋은 선택이 될 수 있다.  
      단점 중 하나는 다른 파일 시스템에 비해 상대적으로 느린 성능이다.

  3. XFS  
      XFS는 실리콘 그래픽스에서 처음 개발한 고성능 저널링 파일 시스템이다.  
      대용량 파일과 파일 시스템을 효율적으로 처리하도록 설계되었으며 수백만 개의 파일과 Terabyte의 데이터를 처리할 수 있도록 확장할 수 있다.  
      XFS는 스냅샷, 하위 볼륨, 온라인 크기 조정과 같은 고급 기능을 지원하므로 데스크톱과 서버 시스템에 좋은 선택이 될 수 있다.

      XFS의 중요한 단점 중 하나는 내장된 데이터 보호 및 복구 메커니즘이 없다는 것이다.  
      예기치 않은 정전이나 시스템 충돌이 발생하면 데이터가 손상되거나 손실될 수 있다.  
      또 다른 한계는 XFS가 파일 시스템 압축을 지원하지 않는다는 것이다.

  4. ZFS  
      ZFS는 원래 "Sun Microsystems"에서 개발한 고성능, 쓰기 시 복사 파일 시스템이다.  
      데이터 압축, 스냅샷, 볼륨 관리와 같은 고급 기능으로 잘 알려져 있다.  
      또한 ZFS는 복원력이 뛰어나며 데이터 오류를 즉시 감지하고 수정할 수 있다.

      ZFS의 중요한 장점 중 하나는 디스크를 조합하여 필요에 따라 동적으로 확장할 수 있는 스토리지 풀을 생성할 수 있다는 점이다.  
      이 기능은 대규모 스토리지 시스템에 이상적이다.  
      그러나 ZFS는 Linux 커널에서 지원되지 않으므로 별도로 설치해야 한다.

## 3-3 액세스 제어 목록 및 파일 시스템 권한
  액세스 제어는 누가 어떤 리소스에 액세스할 수 있는지, 그리고 해당 리소스에 대해 어떤 작업을 수행할 수 있는지 결정하는 데 사용된다.  
  Linux에서 액세스 제어는 파일 시스템 권한과 ACL(액세스 제어 목록)을 통해 구현된다. 

  1. 파일 시스템 권한  
      Linux 파일 시스템 권한은 파일 및 디렉터리에 액세스할 수 있는 사용자와 해당 파일 및 디렉터리에서 수행할 수 있는 작업을 결정한다.  
      각 파일 및 디렉터리에는 읽기, 쓰기 및 실행의 세 가지 유형의 권한이 있다.  
      이러한 권한은 파일 소유자, 파일 그룹 소유자, 기타 모든 사용자 등 세 가지 유형의 사용자에 대해 지정된다.  
      파일 권한을 설정하려면 `chmod` 명령을 사용한다.  
      ``` bash
      chmod [permission] <file name>
      ```
      이 명령은 파일 소유자에게 읽기 권한을 부여합니다. 'u'는 사용자를 의미하며 '+r'은 읽기 권한을 추가한다.
      * [(참고) chmod 명령어](#참고-chmod-명령어)

  2. 액세스 제어 목록  
      파일 시스템 권한은 유용하지만 특정 보안 요구 사항을 충족하기에 충분히 유연하지 않은 경우가 있다.  
      예를 들어 특정 사용자에게만 파일에 대한 읽기 및 쓰기 권한을 부여하고 다른 사용자에게는 부여하지 않으려는 경우 파일 시스템 권한만으로는 이를 수행할 수 없다.  
      이때 액세스 제어 목록이 필요한다.

      ACL은 파일 또는 디렉터리에 첨부된 권한 목록으로, 해당 파일에 액세스할 수 있는 사용자와 그룹 및 수행할 수 있는 작업을 지정한다.  
      ACL은 파일 시스템 권한보다 더 세분화된 제어 기능을 제공한다.  
      예를 들어, ACL을 사용하여 파일의 소유자 또는 그룹 소유자가 아닌 특정 사용자 또는 사용자 그룹에 읽기 및 쓰기 권한을 부여할 수 있다.  
      ACL을 설정은 아래의 명령을 사용한다.  
      ``` bash
      setfacl [옵션] ACL_SPEC 파일
      ```
      * [(참고) chmod 명령어](#참고-chmod-명령어)
      
#### (참고) chmod 명령어  
  `chmod` 명령은 Linux에서 파일 또는 디렉터리의 권한을 변경하는 데 사용된다.  
  소유자, 그룹 소유자 및 기타 사용자에 대한 파일 또는 디렉터리의 읽기, 쓰기 및 실행 권한을 수정할 수 있는 명령줄 유틸리티이다.
  ``` bash
  chmod [option] <permission> <file name>
  ```
  
  1. 옵션  
      * -c: 이 옵션은 파일의 권한이 변경된 경우에만 메시지를 표시한다.  
      * -f: 이 옵션은 발생할 수 있는 오류 메시지를 표시하지 않는다.  
      * -v: 이 옵션은 처리되는 각 파일에 대해 메시지를 표시한다. 

  2. 권한
      * 읽기(r) 권한  
        사용자가 파일 또는 디렉터리의 내용을 볼 수 있도록 허용한다.  
        읽기 권한을 부여하려면 값 4를 사용한다.
      * 쓰기(w) 권한  
        사용자가 파일 또는 디렉터리의 내용을 수정할 수 있도록 허용한다.  
        쓰기 권한을 부여하려면 값 2를 사용한다.
      * 실행(x) 권한  
        사용자가 파일을 실행하거나 디렉터리의 콘텐츠에 액세스할 수 있도록 허용한다.  
        실행 권한을 부여하려면 값 1을 사용한다.
      
  3. 기호 및 숫자 모드
    chmod를 사용하여 설정하려는 권한을 지정하는 방법에는 두 가지가 있습니다:

      1. 기호 모드  
        이 모드는 문자와 기호를 사용하여 설정하려는 권한을 지정한다.  
        기호 모드의 구문은 다음과 같다.
          ``` bash
          chmod [ugoa]+[-+=]+[rwxX] <file name>
          ```
          이 구문에서 u는 파일 소유자를, g는 그룹을, o는 다른 사용자를, a는 모든 사용자를 나타낸다.  
          기호는 권한을 추가하는 데 사용되는데, +/- 기호는 권한을 추가/제거하는 데 사용되며, = 기호는 권한을 지정된 값으로 설정하는 데 사용된다.  
          rwxX 값은 파일이 디렉터리이거나 이미 실행 권한이 있는 경우에만 읽기, 쓰기, 실행 및 실행을 나타낸다.

      2. 숫자 모드  
        이 모드에서는 3자리 코드를 사용하여 설정하려는 권한을 지정한다.  
        각 숫자는 서로 다른 권한 집합을 나타낸다.
          * 첫 번째 숫자는 소유자의 권한을 나타낸다.
          * 두 번째 숫자는 그룹의 권한을 나타낸다.
          * 세 번째 숫자는 다른 모든 사람의 권한을 나타낸다.

#### (참고) setfacl 명령어 
  `setfacl` 명령은 Linux에서 파일 및 디렉터리에 대한 액세스 제어 목록(ACL)을 설정하는 데 사용된다.  
  ACL은 기존 파일 권한보다 더 세분화된 액세스 제어 메커니즘을 제공하여 개별 사용자 또는 그룹에 대한 특정 권한을 설정할 수 있다.
  ``` bash
  setfacl [option] <ACL_SPEC> <file name>
  ```
  여기서 option은 포함할 추가 옵션이고, ACL_SPEC은 설정하려는 ACL의 사양이며, file name은 수정하려는 파일 또는 디렉터리의 이름이다.
  
  1. 옵션  
      * -m: 기존 ACL을 수정한다.  
        특정 사용자 또는 그룹에 대한 권한을 추가하거나 수정하는 데 사용된다.
      * -x: 지정된 ACL 항목을 제거한다.  
        ACL에서 특정 사용자 또는 그룹을 제거하는 데 사용된다.
      * -b: 확장된 모든 ACL 항목을 제거한다.  
        파일 또는 디렉터리에 대한 모든 확장 ACL 항목을 제거하는 데 사용된다.
      * -R: 모든 파일 및 디렉터리에서 재귀적으로 작동한다.  
        디렉터리 트리의 모든 파일과 디렉터리에 지정된 ACL을 적용하는 데 사용된다.  
  2. ACL_SPEC
      1. 표준 형식  
        표준 형식은 사용자 또는 그룹과 부여하거나 거부할 권한을 지정한다.  
        예를 들어 `u:user1:rwx`는 사용자 user1에게 읽기, 쓰기 및 실행 권한이 있어야 함을 지정한다.
      2. 고급 형식  
        고급 형식은 보다 복잡한 ACL을 지정하는 데 사용된다.  
        이 형식에서는 권한이 태그와 한정자의 조합으로 지정된다.  
        예를 들어 `user::rwx,g:group1:rx`는 소유자에게는 읽기, 쓰기 및 실행 권한이 있어야 하고 group1의 구성원에게는 읽기 및 실행 권한이 있어야 함을 지정한다.