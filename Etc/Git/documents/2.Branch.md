# 2장. **Git Branch**

  * [2-1 브랜치란?](#2-1-브랜치란)
  * [2-2 브랜치와 Merge](#2-2-브랜치와-merge)
  * [2-3 리모트 브랜치](#2-3-리모트-브랜치)

## 2-1 브랜치란?  
브랜치는 기존 소스 코드와는 독립적으로 어떤 작업을 진행하기 위한 개념이다.  
브랜치를 생성하면 다른 브랜치의 영향을 받지 않기 때문에, 동시에 여러개의 작업을 진행할 수 있다.  
  <center><img src="../images/2.Branch/Branch.png" width="70%" height="75%"></center>
또한 이렇게 생성한 브랜치를 Merge하여 작업한 내용을 하나의 브랜치로 모을 수도 있다.  
  <center><img src="../images/2.Branch/Branch_Merge.png" width="70%" height="75%"></center>

  1. Branch 생성  
      Branch는 다음 명령어로 생성할 수 있다. `git branch <브랜치명>`  
      새로 생성한 브랜치는 현재 작업하고 있는 마지막 커밋을 가리킨다.  
        <center><img src="../images/2.Branch/Branch_Commit.png" width="70%" height="75%"></center>
      하지만 `git branch` 명령은 Branch를 생성하기만 하고 현재 Branch를 이동하지는 않는다.  
      Branch를 생성했을때의 HEAD는 아래와 같이 기존 작업을 하던 Branch를 가르킨다.  
        <center><img src="../images/2.Branch/Create_Master_Head.png" width="60%"></center>  
  2. Branch 이동  
      생성한 브랜치로 이동하기 위해서는 `git checkout <브랜치명>` 을 사용하면 된다.  
      `git checkout <브랜치명>`로 브랜치를 이동하면 HEAD가 다음과 같이 이동한다.  
        <center><img src="../images/2.Branch/Create_Branch_Head.png" width="60%"></center>  
      `git log` 명령에 `--decorate` 옵션을 사용하면 브랜치가 어떤 커밋을 가리키는지 알 수 있다. 
      
## 2-2 브랜치와 Merge  
  보통 브랜치는 어떤 이슈가 발생했을 때 진행중인 개발 소스와 별개로 처리하기 위해, 현재의 소스에서 여러개의 버전이 만들어 져야할 때 생성해서 사용한다.  
  이슈를 처리했을 경우에는 해당 이슈에 대한 검증을 마치고 그 코드를 운영중인 브랜치(master or main branch)에 머지하여 다시 하나의 브랜치로 관리한다.  
  이때, 브랜치를 운영하는 순서는 아래와 같다.  
  ```
  1. 새로운 이슈를 처리위해 브랜치를 생성한다.  
  2. 생성한 브랜치로 이동해 코드를 수정한다.  
  3. 수정한 이슈에 대한 마치고 운영 브랜치로 Merge 한다.
  ```

  1. Merge의 기초  
    Merge를 수행할 때는 운영중인 브랜치(목적지 브랜치)로 이동하고 머지를 진행한다.  
    예를 들어 master 브랜치에 merge를 하려면 master 브랜치에서 작업을 진행해야 한다는 의미이다.  
    merge를 하기위한 명령어는 다음과 같다.  
    `git merge <merge할 브랜치명>`
    또한, merge를 진행하고 나면 merge된 브랜치는 이제 필요가 없어진다.  
    필요없는 브랜치를 삭제하기 위해서는 `git branch -d <브랜치명>` 명령을 사용한다.

  2. Merge conflict 기초  
    만약 같은 파일의 같은 부분을 두사람이 동시에 작업을 하고 Merge를 시도할 경우 conflict가 발생한다.  
    이때, Git은 자동으로 Merge 하지 못해서 새 커밋이 생기지 않는다.  
    충돌을 해결하지 않으면 Merge 과정을 진행할 수 없다.  
    conflict가 발생했을 떄 `git status` 명령을 사용하면 어떤 파일을 Merge 할 수 없었는지 알 수 있다.  
    충돌이 일어난 파일은 unmerged 상태로 표시되며, Git은 충돌이 난 부분을 표준 형식에 따라 아래와 같이 표시해준다.  
        ```
        <<<<<<< HEAD:index.html
        <div id="footer">contact : email.support@github.com</div>
        =======
        <div id="footer">
        please contact us at support@github.com
        </div>
        >>>>>>> iss53:index.html
        ```
      이때 개발자는 해당 부분을 확인하고 수동으로 conflict를 해결한다.  
      ======= 위쪽의 내용은 HEAD 버전(merge 명령을 실행할 때 작업하던 master 브랜치)의 내용이고 아래쪽은 iss53 브랜치의 내용이다.  
      충돌을 해결하려면 위쪽이나 아래쪽 내용 중에서 고르거나 새로 작성하여 Merge 해야한다.  
      그리고 당연히 `<<<<<<<, =======, >>>>>>>`가 포함된 행을 삭제해야 한다.   이렇게 충돌한 부분을 해결하고 `git add` 명령으로 다시 Git에 저장한다.
  
      또한 다른 Merge tool로도 충돌을 해결할 수 있다.  
      Merge tool로 conflict를 해결하기 위해서는 `git mergetool` 명령을 실행한다.  
      충돌을 해결한 후에는 어떻게 충돌을 해결했고 좀 더 확인해야 하는 부분은 무엇이고 왜 그렇게 해결했는지에 대해 commit에 자세하게 기록해두는 것이 좋다.  
      나중에 이력을 확인하다 보면 이 Merge 커밋이 어떻게 수정이 되었는지 알기 쉽기 떄문이다.  
  
  3. 브랜치 관리  
    `git branch` 명령은 단순히 브랜치를 만들고 삭제하는 명령이 아니다.
    `git branch` 명령에 옵션을 추가하는 것에 따라 여러가지 기능을 제공한다.  
    아무 옵션 없이 `git branch` 명령을 실행하면 브랜치 목록을 보여준다.  
    옵션에 대해서는 아래 표를 참고하자.  
      |명령|설명|
      |:--:|--|
      |-v|브랜치 목록과 마지막 커밋 메세지를 함께 보여줌|
      |--merged|현재 브랜치를 기준으로 merge가 된 브랜치 목록을 보여줌|
      |--no-merged|현재 브랜치를 기준으로 merge가 되지 않은 브랜치 목록을 보여줌|
      |-d <브랜치명>|<브랜치명>에 해당하는 브랜치를 삭제한다.</br>단, Merge되지 않은 브랜치는 삭제되지 않는다.|
      |-D <브랜치명>|<브랜치명>에 해당하는 브랜치를 강제로 삭제한다.</br>Merge되지 않은 브랜치도 삭제된다.|

## 2-3 리모트 브랜치
  리모트 Refs는 리모트 저장소에 있는 포인터인 레퍼런스다.  
  리모트 저장소에 있는 브랜치, 태그, 등등을 의미한다.  
  `git ls-remote <remote>` 명령으로 모든 리모트 Refs를 조회할 수 있다.  
  `git remote show <remote>` 명령은 모든 리모트 브랜치와 그 정보를 보여준다.  
  리모트 Refs가 있지만 보통은 리모트 트래킹 브랜치를 사용한다.  

  1. 리모트 트래킹 브랜치  
    리모트 트래킹 브랜치는 리모트 브랜치를 추적하는 레퍼런스이며 브랜치다.  
    리모트 트래킹 브랜치는 로컬에 있지만 임의로 움직일 수 없다.  
    리모트 서버에 연결할 때마다 리모트의 브랜치 업데이트 내용이 자동으로 갱신된다. 
    즉, 리모트 트래킹 브랜치는 리모트 저장소에 마지막으로 연결했던 순간에 브랜치가 무슨 커밋을 가리키고 있었는지를 나타낸다.  
    리모트 트래킹 브랜치의 이름은 `<remote>/<branch>` 형식으로 되어 있다.  
    참고로 `git clone -o <remote>` 명령을 사용하여 사용자가 지정한 리모트 이름으로 저장소를 clone 할 수 있다.
    